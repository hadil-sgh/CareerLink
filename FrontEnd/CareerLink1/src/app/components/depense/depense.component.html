
  <app-header-front></app-header-front>
  
  <!-- Bouton "Download PDF" align√© au centre -->
  <div class="row justify-content-center mb-3">
    <div class="col-6 text-center">
      <button class="btn btn-success" (click)="generatePDF()">Download PDF</button>
    </div>
  </div>
  <div class="row justify-content-between align-items-center mb-3">
    <div class="col-6 text-center">
      <button class="btn btn-warning btn-block" style="margin-top: 20px;" (click)="tri()">Order My Projects by Date</button>
    </div>
    
    <div class="col-6 text-center">
      <button type="button" class="btn btn-primary btn-block" style="margin-top: 20px;" [routerLink]="'/Employee/reclamation'">
        <i class="fas fa-bullhorn mr-2"></i> Check My Claims
      </button>
    </div>
  </div>
  <div class="container mt-3"></div>
  <div class="row justify-content-center mb-3" >
    <div class="col-6 text-center">
      <button class="btn btn-success" (click)="generatePDF()">Download PDF</button>
    </div>
  </div>
  <div class="container mt-3"#content>
  <div class="card mt-3">
    <div class="card-body">
      <div class="card mt-3">
        <div class="card-body">
         
    
         
          

      <!-- Affichage du montant total lorsque projet s√©lectionn√© -->
      <div class="row justify-content-center mb-3" *ngIf="selectedProjectTotalAmount !== 0">
        <div class="col-6 text-center">
          <h6 style="font-weight: bold; color: black;">Total Amount for Project {{ selectedProjectName }}: {{ selectedProjectTotalAmount }} DT</h6>
          <h6 style="font-weight: bold; color: black;">Amount Remaining to Pay: {{ calculateRemainingAmount(selectedProjectTotalAmount) }} DT</h6>
        </div>
        </div>
      </div>
      <!-- Bouton pour g√©n√©rer le PDF -->
    


      <!-- Liste des projets avec montant total -->
      <div class="row justify-content-center mb-3">
        <div class="col-6 text-center">
          <div class="d-flex flex-wrap justify-content-center">
            <div *ngFor="let project of projects" class="mr-2 mb-2">
              <button type="button" class="btn btn-primary btn-dark" (click)="selectProject(project.name)">
                <i class="fas fa-project-diagram mr-2"></i> {{ project.name }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Liste des d√©penses filtr√©es par projet s√©lectionn√© -->
      <div class="row row-cols-1 row-cols-md-5">
        <ng-container *ngFor="let expense of filterExpensesByProject(selectedProjectName)">
          <div class="col mb-4">
            <div class="card shadow-sm expense-card">
              <div class="card-body">
                <p class="card-text"><strong>Project:</strong> {{ expense.project ? expense.project.name : 'N/A' }}</p>
                <p class="card-text"><strong>Amount:</strong> {{ expense.amount }}</p>
                <p class="card-text"><strong>Date:</strong> {{ expense.dateexpense | date }}</p>
                <p class="card-text"><strong>Category:</strong> {{ expense.category }}</p>
                <p class="card-text"><strong>Method Payment:</strong> {{ expense.methodPayment }}</p>

                <div class="d-flex justify-content-between align-items-center mt-3">
                  <button type="button" class="btn"
                    [ngClass]="{'btn-success': expense.statusPayment === 'PAYE', 'btn-dark': expense.statusPayment !== 'PAYE'}"
                    (click)="openPaymentModal(expense)" 
                    [disabled]="expense.statusPayment === 'PAYE' || expense.methodPayment === 'CASH'">
                    <i class="fas fa-money-bill-alt mr-2"></i>
                    {{ expense.statusPayment === 'PAYE' ? 'Paid‚úîÔ∏è' : (expense.methodPayment === 'CASH' ? 'Pay Cashüí≤' : 'Payüí≥') }}
                    <ng-container *ngIf="expense.statusPayment === 'PAYE'">
                      <i class="fas fa-check-circle text-success ml-1"></i>
                    </ng-container>
                  </button>

                  <!-- Show "Claim" button only if payment is not made -->
                  <ng-container *ngIf="expense.statusPayment !== 'PAYE'">
                    <button type="button" class="btn btn-warning" [disabled]="hasReclamation(expense)" [routerLink]="['/Employee/reclamation', expense.idexpense]">
                      <i class="fas fa-bullhorn mr-2"></i> {{ hasReclamation(expense) ? 'Claimed' : 'Claimüì£' }}
                    </button>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Message si aucune d√©pense n'est trouv√©e pour le projet s√©lectionn√© -->
      <div *ngIf="filterExpensesByProject(selectedProjectName).length === 0" class="text-center mt-4">
        <p>No expenses found for the selected project.</p>
      </div>
    </div>
  </div>

  <!-- Modal de d√©tails de paiement -->
  <div id="paymentModal" class="modal" *ngIf="selectedExpense && selectedExpense.methodPayment !== 'CASH'">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Payment Details</h5>
          <button type="button" class="close" (click)="closePaymentModal()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form [formGroup]="expenseForm" (ngSubmit)="payExpense(selectedExpense)">
            <div class="form-group">
              <label for="cardNumber">Card Number:</label>
              <input type="text" id="cardNumber" class="form-control" formControlName="cardNumber" placeholder="1234 1234 1234 1234 " (input)="formatCardNumber($event)">
              <div *ngIf="isInvalidControl('cardNumber')" class="invalid-feedback">
                Please provide a valid card number.
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="expirationDate">Expiration Date:</label>
                <input type="text" id="expirationDate" class="form-control" formControlName="expirationDate" placeholder="MM/YYYY" required>
                <div *ngIf="isInvalidControl('expirationDate')" class="invalid-feedback">
                  Please provide a valid expiration date (MM/YYYY).
                </div>
              </div>
              <div class="form-group">
                <label for="securityCode">Security Code:</label>
                <div class="input-group">
                  <input type="{{ securityCodeVisible ? 'text' : 'password' }}" id="securityCode" class="form-control" formControlName="securityCode" maxlength="4" placeholder="****" required>
                  <div class="input-group-append">
                    <label class="input-group-text" (click)="toggleSecurityVisibility()" style="cursor: pointer;">
                      <span>üëÅÔ∏è‚Äçüó®Ô∏è</span>
                    </label>
                  </div>
                </div>
                <div *ngIf="isInvalidControl('securityCode')" class="invalid-feedback">
                  Please provide a valid security code (4 digits).
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closePaymentModal()">Close</button>
          <button type="button" class="btn btn-success" 
            (click)="payExpense(selectedExpense)" 
            [disabled]="expenseForm.invalid">
            Pay {{ selectedExpense.amount }} DT
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .exclude-pdf {
  display: none;
}
</style>